\chapter{Технологическая часть}

\section{Средства реализации}

В качестве языка программирования был выбран язык \textit{C\#} \cite{csharp}. Он обладает возможность создания Web-приложений. Также данный язык программирования поддерживает принципы ООП, что крайне важно для поставленной задачи -- имеется возможность создать понятную и простую структуру программного кода.

Фреймворком для работы с СУБД был выбран \textit{Entity Framework Core} \cite{ef_core}. Данный фреймворк является основным для языка C\# и имеет множество учебной литературы.

\textit{Visual Studio} \cite{vs} был выбран в качестве среды разработки, так как имеется бесплатная версия для студентов, хороший дебаггер и полноценная поддержка языка C\#. 

Для разработки непосредственно Web-приложения используется фреймворк \textit{ASP.NET} \cite{asp}. Данный фреймворк является абсолютно бесплатным и обладает широким функционалом для разработки. Имеет поддержку мультистраничных сайтов.


\section{Архитектура приложения}

Архитектура приложения построена на основе схемы MVC (модель-представление-контроллер) \cite{mvc}. Использование данной схемы позволяет разрабатывать каждый из компонентов независимо от других. Это имеет следующие преимущества:

\begin{itemize}
    \item изменения одного из компонентов не влияют на работоспособность других компонентов;
    \item имеется возможность подмены (Web-интерфейс может быть заменен на интерфейс десктопного приложения).
\end{itemize}

Схема взаимодействие компонентов MVC представлена на рисунке \ref{img:mvc}
\imgs{mvc}{h!}{3}{Схема взаимодействие компонентов MVC}


\section{Структура классов}

Классы приложения разбиты на 3 основных слоя:

\begin{itemize}
    \item слой доступа к данным, который состоит из классов моделей и репозиториев, для работы с данными;
    \item слой бизнес логики, состоящих из классов-сервисов, которые реализуют основную логику Web-приложения;
    \item слой контроллеров, которые, в ответ на действия пользователя, вызывают соответствующие методы слоя бизнес логики.
\end{itemize}

На рисунке \ref{img:da_and_bl_layers} представлена схема взаимодействия классов между слоем доступа к данным и слоем бизнес логики приложения. 
\imgs{da_and_bl_layers}{h!}{0.35}{Взаимодействие классов доступа к данным и бизнес логики}

\newpage


\section{Выбор СУБД}

\subsection{Виды СУБД}

Выбор системы управления базой данных является важной частью разработки программного продукта. Выбранная СУБД должна соответствовать всем требованиям, которые предъявляются при разработке. Рассмотрим наиболее популярные СУБД. 

\begin{itemize}
    \item \textbf{MySQL} \cite{mysql} -- является одной из самых популярных СУБД. Распространяется бесплатно. Из-за высокого спроса, часто выходят новые обновления, исправляющие ошибки и добавляющие много нового функционала. Не подходит для простых задач из-за трудной настройки. Не имеет ряда функционала, который в других СУБД реализован по умолчанию.
    \item \textbf{Microsoft SQL Server} \cite{sqlserver} -- собственная разработка компании Microsoft. Имеется поддержка для работы на операционной системе Linux, но наилучшую поддержку имеет для операционной системы Windows и иных продуктов компании Microsoft. Имеет проблемы с оптимизацией использования ресурсов. Проста в использовании.

    \item \textbf{Oracle} \cite{oracle} -- крайне популярна в крупных компаниях. Распространяется по подписке. Является одной из самых безопасных СУБД, так как каждая транзакция полностью изолирована друг от друга. Требует больших вычислительных ресурсов, тем самым не подходит для небольших проектов.

    \item \textbf{PostgreSQL} \cite{postgres} -- одна из самых популярных СУБД, которые распространяются бесплатно и имеют высокое качество. Имеет хорошую оптимизацию, особенно под операционную систему Linux. Часто использует при разработке Web-приложений и хорошо подходит для небольших проектов. Имеет трудную настройку для неподготовленного пользователя.
\end{itemize}


\subsection{Вывод}

Выбор СУБД будет произведен, исходя из следующих критериев:

\begin{itemize}
    \item К1 -- подробная документация;
    \item К2 -- высокий уровень оптимизации;
    \item К3 -- подходит для разработки небольших проектов;
    \item К4 -- поддержка различных форматов файлов;
    \item К5 -- распространяется бесплатно.
\end{itemize}

\captionsetup{justification=raggedleft,singlelinecheck=off}
\begin{table}[H]
    \centering
	\caption{Сравнение СУБД}
    \label{tbl:compare_subd}
	\begin{tabular}{|l|l|l|l|l|l|}
        \hline
        \textbf{Название} & \textbf{К1} & \textbf{К2} & \textbf{К3} & \textbf{К4} & \textbf{К5} \\ \hline

        <<MySQL>>                   & + & + & - & - & + \\ \hline
        <<Microsoft SQL Server>>    & - & - & + & + & - \\ \hline
        <<Oracle>>                  & + & - & - & + & - \\ \hline
        <<PostgreSQL>>             & - & + & + & + & + \\ \hline

    \end{tabular}
\end{table}

Исходя из того, что разрабатывается небольшое Web-приложение, то наилучшим образом подходит СУБД PostgreSQL, так как она обладает всеми необходимыми требованиями.


\section{Реализация функций}

При разработке были реализованы следующие функции базы данных, описанные в разделе \ref{functions}.

\begin{enumerate}
    \item Функция выбора серверов (листинг \ref{lst:getServers}).
        \mylisting[sql]{parseServers.sql}
            {firstline=2,lastline=17}{Функция выбора серверов}{getServers}{}

    \item Функция фильтрации серверов (листинг \ref{lst:filterServers}).
        \mylisting[sql]{parseServers.sql}
            {firstline=21,lastline=41}{Функция фильтрации серверов}{filterServers}{}

    \item Функция сортировки серверов (листинги \ref{lst:sortServers1}-\ref{lst:sortServers2}) %(листинг \ref{lst:sortServers}).
        % \mylisting[sql]{parseServers.sql}
        %     {firstline=45,lastline=106}{Функция сортировки серверов}{sortServers}{}

    \item Функция парсинга серверов (обертка) (листинг \ref{lst:parseServers}).
        \mylisting[sql]{parseServers.sql}
            {firstline=113,lastline=120}{Функция парсинга серверов}{parseServers}{}
\end{enumerate}


\section{Реализация триггеров}

В проектируемой базе данных определены следующие триггеры, которые описаны в разделе \ref{functions}.

\begin{enumerate}
    \item Триггеры изменения рейтинга сервера и функция, реализующая работу этих триггеров (листинг \ref{lst:changeServerRating}).
        \mylisting[sql]{changeServerRating.sql}
            {firstline=5,lastline=30}{Триггеры изменения рейтинга сервера}{changeServerRating}{}

    \item Триггер установки роли пользователя и функция, реализующая его работу (листинг \ref{lst:userRole}).
        \mylisting[sql]{userRole.sql}
            {firstline=3,lastline=17}{Триггер установки роли пользователя}{userRole}{}
\end{enumerate}


\section{Реализация ролевой модели}

В базу данных были введены следующие роли, которые были рассмотренною в разделе \ref{roles}.

\begin{enumerate}
    \item Неавторизованный пользователь. В листинге \ref{lst:nonAuthUserRole} представлено создание роли и раздача необходимых прав.
        \mylisting[sql]{roles.sql}
            {firstline=16,lastline=30}{Неавторизованный пользователь}{nonAuthUserRole}{}

    \item Авторизованный пользователь. В листинге \ref{lst:authUserRole} представлено создание роли и раздача необходимых прав.
        \mylisting[sql]{roles.sql}
            {firstline=34,lastline=57}{Авторизованный пользователь}{authUserRole}{}

    \item Администратор сайта. В листинге \ref{lst:adminRole} представлено создание роли и раздача необходимых прав.
        \mylisting[sql]{roles.sql}
            {firstline=2,lastline=12}{Администратор сайта}{adminRole}{}
\end{enumerate}


\section{Полученный результат}

Спроектировано мультистраничное Web-приложение для поиска серверов игры. В зависимости от роли пользователя меняется и интерфейс сайта, и его функционал.

\begin{enumerate}
    \item \textbf{Возможности неавторизованного пользователя.} Неавторизованный пользователь может увидеть список серверов с указанием платформы, на которой располагается каждый сервер, что показано на рисунке \ref{img:nonauth_main}. При этом также доступны сортировка этого списка серверов и его фильтрация, в том числе, по различным платформам, что отображено на рисунке \ref{img:filter_platform}. Также неавторизованному пользователю доступна страница детальной информации о сервере, но доступна лишь информация о самом сервере (рисунок \ref{img:nonauth_detail}). Для того, чтобы увидеть подробную информацию, пользователь должен авторизоваться на сайте (рисунок \ref{img:login}) или зарегистрироваться на сайте (рисунок \ref{img:register}).
    
    \item \textbf{Возможности авторизованного пользователя.} Главная страница сайта со списком серверов для авторизованного пользователя выглядит уже по-другому (рисунок \ref{img:auth_main}). Теперь на строчке каждого сервера появилась кнопка, которая позволяет добавить данный сервер в список избранных серверов (или кнопка удаления сервера из избранного, если таковой был добавлен), также появилась вкладка для перехода к избранным серверам в <<шапке>> сайта.
    
    Страница детальной информации о сервере также изменилась -- теперь там выводится информация о хостинге, на котором расположен данный сервер, и список игроков, играющих на этом сервере, что видно на рисунке \ref{img:auth_detail}.

    Также на рисунке \ref{img:auth_favorite} можно увидеть страницу избранных серверов некоторого пользователя. Здесь также доступна вся информация о серверах, список можно также отсортировать и отфильтровать.

    \item \textbf{Возможности администратора сайта} Администратор сайта, помимо вышеперечисленного списка для авторизованного пользователя, обладает рядом важных возможностей. В <<шапке>> сайта (рисунок \ref{img:admin_main}) стала доступна новая ссылка -- ссылка на панель управления сайтом. Как видно из рисунка \ref{img:admin_control}, данная панель отображает две страницы управления -- страница управления серверами и страница управления ролями пользователей.
    
    Страница управления серверами (рисунок \ref{img:admin_server_control}) обладает рядом возможностей -- добавить сервер (страница добавления показана на рисунке \ref{img:admin_add_server}), обновить сервер (рисунок \ref{img:admin_update_server}) или удалить его.
    
    Страница управления ролями пользователей (рисунок \ref{img:admin_user_control}) позволяет изменять роль выбранного пользователя (рисунок \ref{img:admin_role_update}). При этом запрещено изменять свою собственную роль и изменять роль администратору с логином <<admin>>, чтобы на сайте всегда был минимум один администратор.
\end{enumerate}

\imghw{nonauth_main}{h!}{11cm}{15cm}{Главная страница сайта (неавторизованный пользователь)}
\imghw{filter_platform}{t!}{11cm}{15cm}{Фильтрация списка серверов по платфорам}
\imghw{nonauth_detail}{t!}{11cm}{18cm}{Страница подробной информации о сервере (неавторизованный пользователь)}
\imgh{login}{t!}{11cm}{Страница авторизации для пользователя}
\imgh{register}{t!}{12cm}{Страница регистрации для нового пользователя}

\imghw{auth_main}{t!}{11cm}{15cm}{Главная страница сайта (авторизованный пользователь)}
\imghw{auth_detail}{t!}{11cm}{15cm}{Страница подробной информации о сервере (авторизованный пользователь)}
\imghw{auth_favorite}{t!}{11cm}{15cm}{Страница избранных серверов авторизованного пользователя}

\imghw{admin_main}{t!}{12cm}{15cm}{Главная страница сайта (администратор сайта)}
\imghw{admin_control}{t!}{11cm}{15cm}{Страница управления сайтом}
\imghw{admin_server_control}{t!}{12cm}{15cm}{Страница управления серверами}
\imghw{admin_add_server}{t!}{11cm}{15cm}{Страница добавления нового сервера}
\imghw{admin_update_server}{t!}{12cm}{15cm}{Страница обновления сервера}
\imghw{admin_user_control}{t!}{11cm}{15cm}{Страница управления ролями пользователей сайта}
\imghw{admin_role_update}{t!}{12cm}{15cm}{Страница изменения роли пользователя}
\clearpage

\section*{Вывод}

В данном разделе были рассмотрены средства реализации программного продукта, его архитектура и структура классов. Также были приведены реализации функций, триггеров и ролей базы данных. Был проведен выбор СУБД, в результате которого был выбран PostgreSQL. Также приведен результат работы получившегося веб-приложения. 
