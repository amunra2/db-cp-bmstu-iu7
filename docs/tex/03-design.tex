\chapter{Конструкторская часть}

В данном разделе приведено описание таблиц разрабатываемой базы данных, а также описаны функции, триггеры и роли базы данных.


\section{Описание таблиц базы данных}

Схема разрабатываемой базы данных приведена на рисунке \ref{img:db_scheme}.

\imgs{db_scheme}{h!}{0.5}{Диаграмма базы данных}

Реализуемая модель базы данных содержит 7 таблиц.

\begin{enumerate}
    \item Таблица <<Server>> хранит информацию о серверах. Содержит следующие поля:
        \begin{itemize}
            \item ID -- первичный ключ; тип данных -- unsigned;
            \item Name -- уникальное название сервера; тип данных -- varchar(255);
            \item IP -- уникальный IP-адрес сервера; тип данных -- varchar(30);
            \item GameVersion -- версия игры, для которой открыт данный сервер; тип данных -- varchar(255);
            \item Rating -- рейтинг сервера; тип данных -- integer;
            \item HostingID -- идентификатор хостинга; тип данных -- unsigned;
            \item PlatformID -- идентификатор платформы; тип данных -- unsigned;
        \end{itemize}

        \item Таблица <<User>> хранит информацию о пользователе сайта. Содержит следующие поля:
        \begin{itemize}
            \item ID -- первичный ключ; тип данных -- unsigned;
            \item Login -- уникальный логин на сайте; тип данных -- varchar(255);
            \item Password -- пароль на сайте; тип данных -- varchar(255);
            \item Role -- роль пользователя; тип данных -- varchar(255);
        \end{itemize}

        \item Таблица <<FavoriteServer>> хранит информацию об избранных серверах игроков. Является связующей таблицей между таблицами <<Server>> и <<User>>. Содержит следующие поля:
        \begin{itemize}
            \item ID -- первичный ключ; тип данных -- unsigned;
            \item UserID -- идентификатор пользователя; тип данных -- unsigned;
            \item ServerID -- идентификатор сервера; тип данных -- unsigned;
        \end{itemize}

        \item Таблица <<Player>> хранит информацию об игроке сервера. Содержит следующие поля:
        \begin{itemize}
            \item ID -- первичный ключ; тип данных -- unsigned;
            \item Nickname -- уникальный никнейем игрока; тип данных -- varchar(255);
            \item HoursPlayed -- количество часов, сыгранных на серверах; тип данных -- unsigned;
            \item LastPlayed -- дата крайнего раза захода на сервер; тип данных -- unsigned;
        \end{itemize}

        \item Таблица <<FavoriteServer>> хранит информацию об игроках и на каких серверах они играют. Является связующей таблицей между таблицами <<Server>> и <<Player>>. Содержит следующие поля:
        \begin{itemize}
            \item ID -- первичный ключ; тип данных -- unsigned;
            \item PlayerID -- идентификатор игрока; тип данных -- unsigned;
            \item ServerID -- идентификатор сервера; тип данных -- unsigned;
        \end{itemize}

        \item Таблица <<Hosting>> хранит информацию о хостинге, на котором находится сервер. Содержит следующие поля:
        \begin{itemize}
            \item ID -- первичный ключ; тип данных -- unsigned;
            \item Name -- уникальное название хостинга; тип данных -- varchar(255);
            \item PricePerMonth -- плата за размещение сервера на хостинге в месяц; тип данных -- unsigned;
            \item SubMonts -- количество месяцев подписки сервера на хостинг; тип данных -- unsigned;
        \end{itemize}

        \item Таблица <<Platform>> хранит информацию о платформах, на которых может быть запущена игра. Содержит следующие поля:
        \begin{itemize}
            \item ID -- первичный ключ; тип данных -- unsigned;
            \item Name -- уникальное название платформы; тип данных -- varchar(255);
            \item Popularity -- популярность платформы; тип данных -- unsigned;
            \item Cost -- стоимость платформы; тип данных -- unsigned;
        \end{itemize}
\end{enumerate}


\section{Функции базы данных} \label{functions}

В проектируемой базе данных определены следующие функции.

\begin{enumerate}
    \item \textbf{Функция выбора серверов}. Данная функция выбирает или все сервера из таиблицы <<Server>>, или только избранные сервера пользователя по его идентификатору. Схема алгоритма функции представлена на рисунке \ref{img:get_servers}.
    % \item \imgs{get_servers}{h!}{0.4}{Функция выбора серверов}

    \item \textbf{Функция фильтрации серверов}. Данная функция фильтрует сервера из таблицы <<Server>>, полученные после работы функции выбора серверов. Фильтрация происходит по названию сервера и/или идентификатору платформы. Схема алгоритма функции представлена на рисунке \ref{img:filter_servers}.
    % \imgs{filter_servers}{h!}{0.4}{Функция фильтрации серверов}

    \item \textbf{Функция сортировки серверов}. Данная функция сортирует сервера из таблицы <<Server>>, полученные после работы функции фильтрации серверов. Сортировка происходит по полям: название сервера, IP-адрес сервера, версия игры сервера, рейтинг сервера, названию платформы (все -- по возрастанию и по убыванию). Схема алгоритма функции представлена на рисунке \ref{img:sort_servers}.
    % \imgs{sort_servers}{h!}{0.3}{Функция сортировки серверов}

    \item \textbf{Функция парсинга серверов}. Данная функция является некой <<прослойкой>>, которая возвращает все сервера из таблицы <<Server>>, полученных после работы функции сортировки серверов. Схема алгоритма функции представлена на рисунке \ref{img:parse_servers}.
    % \imgs{parse_servers}{h!}{0.4}{Функция парсинга серверов}
\end{enumerate}

\imgs{get_servers}{h!}{0.4}{Функция выбора серверов}
\imgs{parse_servers}{h!}{0.4}{Функция парсинга серверов}
\imgs{sort_servers}{h!}{0.3}{Функция сортировки серверов}
\clearpage
\imgs{filter_servers}{h!}{0.4}{Функция фильтрации серверов}


\section{Триггеры базы данных} \label{triggers} 

В проектируемой базе данных определены следующие триггеры.

\begin{enumerate}
    \item \textbf{Триггер установки роли пользователя}. Данный триггер срабатывает при операции <<Insert>> в таблицу <<User>> и вызывает функцию установки роли пользователя, которая выдает пользователю роль <<User>> или <<Admin>>, если его логин <<admin>>. Таким образом, в базе данных точно будет один администратор для управления сайтом. Схема алгоритма вызываемой функции представлена на рисунке \ref{img:set_user_role}.
    % \imgs{set_user_role}{h!}{0.4}{Функция выдачи роли пользователю}

    \item \textbf{Триггеры изменения рейтинга сервера}. Один триггер срабатывает при операции <<Insert>> в таблицу <<FavoriteServer>> и вызывает функцию \textit{увеличения} рейтинга добавленного сервера на единицу, а второй триггер -- при операции <<Delete>> из таблицы <<FavoriteServer>> и вызывает функцию \textit{уменьшения} рейтинга удаляемого сервера на единицу. Схема алгоритма вызываемой функции представлена на рисунке \ref{img:set_user_role}.
    % \imgs{change_server_rating}{h!}{0.4}{Функция имзенения рейтинга сервера}
\end{enumerate}

\imgs{set_user_role}{h!}{0.3}{Функция выдачи роли пользователю}
\imgs{change_server_rating}{h!}{0.3}{Функция изменения рейтинга сервера}


\section{Роли базы данных} \label{roles}

В проектируемой базе данных определены следующие роли.

\begin{enumerate}
    \item \textbf{Неавторизованный пользователь}. Данная роль обладает возможность просмотра таблиц серверов и платформ, так как общий список серверов доступен всем видам пользователей. Также обладает возможностью добавлять в таблицу <<User>> для регистрации нового аккаунта.
    \item \textbf{Авторизованный пользователь}. Данная роль обладает возможность просмотра таблиц серверов, платформ для списка серверов; просмотра таблиц <<Hosting>>, <<Player>> и <<ServerPlayer>> для получения детальной информации о сервере; просмотра таблицы <<FavoriteServer>> для просмотра серверов из списка избранного. Также обладает возможностью добавлять и удаления в таблице <<FavoriteServer>> для добавления и удаления серверов из списка изрбанного.
    \item \textbf{Администратор сайта}. Данная роль обладает возможность просмотра, добавления и удаления на все определенные в базе данных таблицы.
\end{enumerate}

\section*{Вывод}

В данном разделе были подробно описаны все поля всех таблиц проектирумой базы данных, ее функции, триггеры и роли.
